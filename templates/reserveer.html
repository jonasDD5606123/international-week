{% extends "base.html" %}

{% block content %}
    <h1>Drone reserveren</h1>
    <form id="reservation-form" method="POST">
        <h2>Locatie:</h2>
        {% if selected_location %}
            <p>{{ selected_location.naam }}</p>
            <input type="hidden" name="location_id" value="{{ selected_location.id }}">
        {% else %}
            <select name="location_id" id="location-select" required>
                <option value="" disabled selected>Kies een locatie</option>
                {% for location in locations %}
                    <option value="{{ location.id }}">{{ location.naam }}</option>
                {% endfor %}
            </select>
        {% endif %}

        <div id="drone-selection">
            <h3>Drone:</h3>
            {% if selected_drone %}
                <p>Drone #{{ selected_drone.ID }} (Batterij: {{ selected_drone.batterijlevel }}%)</p>
                <input type="hidden" name="drone_id" value="{{ selected_drone.ID }}">
            {% else %}
                <p>Selecteer een locatie om drones weer te geven.</p>
            {% endif %}
        </div>

        <button type="submit">Reserveer</button>
    </form>

    {% if not selected_location %}
<script>
    document.getElementById('location-select').addEventListener('change', function() {
        var locationId = this.value;
        var dronesContainer = document.getElementById('drone-selection');
        dronesContainer.innerHTML = '<h3>Beschikbare drone:</h3>';

        var locations = {{ locations|tojson|safe }};
        var selectedLocation = locations.find(loc => loc.id == locationId);

        if (selectedLocation && selectedLocation.beschikbare_drones.length > 0) {
            selectedLocation.beschikbare_drones.forEach(function(drone) {
                var droneElement = document.createElement('div');
                droneElement.innerHTML = `
                    <input type="radio" name="drone_id" value="${drone.ID}" required>
                    <label>Drone #${drone.ID} (Batterij: ${drone.batterijlevel}%)</label><br>
                `;
                dronesContainer.appendChild(droneElement);
            });
        } else {
            dronesContainer.innerHTML += '<p>Geen drones beschikbaar voor deze locatie.</p>';
        }
    });
</script>
    {% endif %}
{% endblock %}